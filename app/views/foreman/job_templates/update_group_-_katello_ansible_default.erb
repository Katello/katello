<%#
name: Update Group - Katello Ansible Default
snippet: false
model: JobTemplate
job_category: Katello via Ansible
description_format: Install package group(s) %{package}
template_inputs:
- name: package
  required: true
  input_type: user
  advanced: false
provider_type: Ansible
kind: job_template
%>
---
- hosts: all
  tasks:
    - name: Collect bootc status
      shell:
        cmd: 'bootc status --json'
      register: bootc_status
      ignore_errors: true
    - name: Parse bootc status json
      set_fact:
        bootc_status_json: "{{ bootc_status.stdout | from_json }}"
      when: bootc_status.rc == 0
    - name: Update groups via dnf for image mode machines
      shell:
        cmd: 'dnf -y --transient group update <%= input('package') %>'
      register: out
      when: bootc_status_json is defined and bootc_status_json['status']['booted'] != 'null'
    - name: Update groups normally
      shell:
        cmd: 'yum -y group update <%= input('package') %>'
      register: out
      when: bootc_status_json is not defined or bootc_status_json['status']['booted'] == 'null'
    - debug: var=out
