#
# WARNING: THIS CONFIGURATION WAS GENERATED BY KATELLO-CONFIGURE TOOL,
# CHANGES WILL LIKELY BE OVERWRITTEN.
#

NameVirtualHost *:443
<VirtualHost *:443>

  ErrorLog /etc/httpd/logs/ssl_kt_error_log
  TransferLog /etc/httpd/logs/ssl_kt_access_log
  LogLevel warn

  ProxyRequests Off
  SSLEngine On
  SSLCertificateFile <%= scope.lookupvar("katello::params::ssl_certificate_file") %>
  SSLCertificateKeyFile <%= scope.lookupvar("katello::params::ssl_certificate_key_file") %>
  SSLCaCertificateFile <%= scope.lookupvar("katello::params::ssl_certificate_ca_file") %>
  ProxyPreserveHost Off
  RequestHeader set X_FORWARDED_PROTO 'https'

  # Performance related configurations
  AddOutputFilterByType DEFLATE text/html text/css application/x-javascript application/javascript
  KeepAlive On
  Timeout 5400
  ProxyTimeout 5400

  Include conf.d/katello.d/*.conf
</VirtualHost>

NameVirtualHost *:80
<VirtualHost *:80>
  RewriteEngine On
  RewriteCond %{HTTPS} off
  RewriteRule /<%= scope.lookupvar("katello::params::deployment_url") %>(.*)$ https://%{HTTP_HOST}%{REQUEST_URI}
  <%- if scope.lookupvar("katello::params::deployment") == 'katello' -%>
  Include /etc/pulp/vhosts80/*.conf
  <%- end -%>
</VirtualHost>
