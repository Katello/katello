<span page-title ng-model="repository">{{ 'Manage Branches for Repository:' | translate }} {{ repository.name }}</span>

<a ui-sref="products.details.repositories.info({productId: product.id, repositoryId: repository.id})">
  <i class="fa fa-angle-double-left"></i>
  {{ "Back to Repository Details" | translate }}
</a>

<div>
  <div data-block="header">
    <h3 translate>Branches in {{ repository.name }}</h3>
  </div>

  <div data-block="messages">
    <div bst-alerts success-messages="successMessages" error-messages="errorMessages"></div>
  </div>

  <div data-block="actions">
    <div bst-modal="removeBranches()">
      <div data-block="modal-header"
           translate-n="getSelectedBranches().length"
           translate-plural="Remove {{ getSelectedBranches().length }} Branches?">
        Remove {{ getSelectedBranches().length  }} Branches?
      </div>
      <div data-block="modal-body"
           translate-n="getSelectedBranches().length"
           translate-plural="Are you sure you want to remove the {{ getSelectedBranches().length }} Branches selected?">
        Are you sure you want to remove the {{ getSelectedBranches().length }} Branches selected?
      </div>
    </div>
    <div class = "fr">
      <button class="btn btn-default"
              ng-click="openModal()"
              ng-hide="denied('edit_products')"
              ng-disabled="getSelectedBranches().length === 0">
        <span translate>Remove Branches</span>
      </button>
    </div>
  </div>

  <div data-block="table">
    <table class="table table-striped table-bordered" >
      <thead>
        <tr>
          <th class="row-select">
            <input type="checkbox"
                   ng-model="allSelected"
                   ng-change="selectAll(allSelected)"
                   ng-disabled = "branchObjects.length === 0"
                   ng-hide="denied('edit_products')"/>
          </th>
          <th translate>Branch Name</th>
          <th></th>
        </tr>
      </thead>

      <tbody>
        <tr>
          <td></td><!-- Empty cell since the first row is special -->
          <td>
            <input type="text"
                   class="form-control"
                   ng-model="branch.name"/>
          </td>
          <td class="action-cell">
            <button class="btn btn-default"
                    ng-click="branch.working = true; addBranch(branch)"
                    ng-hide="denied('edit_products')"
                    ng-disabled="branch.working || !isValid(branch)">
              <i class="fa fa-plus"></i>
              <span translate>Add</span>
            </button>
          </td>
        </tr>

        <tr ng-repeat="branchObject in branchObjects" row-select="branchObject">
          <td class="row-select">
            <input type="checkbox"
                   ng-hide="denied('edit_products')"
                   ng-model="branchObject.selected"/>
          </td>
          <td>
            <input class="form-control"
                   ng-hide="denied('edit_products')"
                   ng-model="branchObject.name"
                   ng-readonly="!branchObject.editMode"/>
          </td>
         <td class="action-cell">
            <button class="btn btn-default" ng-click="branchObject.editMode = true; backupPrevious(branchObject)" ng-hide="denied('edit_products') || branchObject.editMode">
              <i class="fa fa-edit"></i>
              <span translate>Edit</span>
            </button>

            <button bst-save-control
                    on-cancel="restorePrevious(branchObject); branchObject.editMode = false"
                    on-save="updateBranch(branchObject)"
                    working="branchObject.working"
                    ng-show="permitted('edit_products') && branchObject.editMode">
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

</div>
